<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>electron-basic-Bookmark</title>
    <link rel="stylesheet" href="node_modules/photonkit/dist/css/photon.css"><!-- photonkit -->
</head>
<body>
    <div class="window">
        <header class="toolbar toolbar-header">
        <div class="toolbar-actions">
            <h1 class="title">Bang's Bookmark</h1>
            <div class="btn-group">
                <button class="btn btn-default" id="btn-home">
                    <span class="icon icon-home"></span>
                </button>
                <button class="btn btn-default" id="btn-github">
                    <span class="icon icon-github"></span>
                </button>
            </div>
        </div>
        </header>
        <div class="window-content">
            <ul class="list-group" id="data">
            </ul>
        </div>
    </div>
    <script>
        const {ipcRenderer, clipboard, shell} = require('electron');//메인프로세스의 데이터를 받기 위함
        let type = 'home';
        let data = [];

        const btnHome = document.querySelector('#btn-home');
        const btnGithub = document.querySelector('#btn-github');

        // 버튼 초기화
        btnHome.classList.add('active');
        btnGithub.classList.remove('active');

        ipcRenderer.on('update', (event, _data) => {
            data = _data;
            update();
        });

        btnHome.addEventListener('click', () => {
            if(type === 'home') {//type이 home면 더 이상 동작하지 않는다.
                return;
            }
            btnHome.classList.add('active');
            btnGithub.classList.remove('active');
            type = 'home';
            update();
        });

        btnGithub.addEventListener('click', () => {
            if(type === 'github') {
                return;
            }
            btnGithub.classList.add('active');
            btnHome.classList.remove('active');
            type = 'github';
            update();
        });

        function update() {
            const items = data.filter((item, index) => {
                item.removeId = index;
                return item.type === type;
            });
            const htmls = items.map(item => {
                return `
                <li class="list-group-item">
                    <div class="media-body">
                        <strong><a href="#">${item.url}</a></strong>
                        <p>
                            ${item.title}
                            <span class="icon icon-trash pull-right"></span>
                        </p>
                    </div>
                </li>
                `
            });
            const html = htmls.join('');
            document.querySelector('#data').innerHTML = html;
            const removeDoms = document.querySelectorAll('.icon-trash');
            removeDoms.forEach((removeDom, index) => {
                removeDom.addEventListener('click', () => {
                    ipcRenderer.send('remove', items[index].removeId);
                });
            });
            const openDoms = document.querySelectorAll('.list-group-item a');
            openDoms.forEach(openDom => {
                openDom.addEventListener('click', (e) => {
                    shell.openExternal(e.target.innerHTML);//e.target.innerHTML a태그가 감싸고 있는 url을 가져온다.
                });
            });
        }

        document.addEventListener('paste', () => {
            //electron에서 제공하는 clipboard 사용
            const text = clipboard.readText();
            const item = {
                type: type,
                url: text
            };
            ipcRenderer.send('paste', item);
        })
    </script>
</body>
</html>
